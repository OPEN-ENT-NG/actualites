<!DOCTYPE html>
<html>
<head>
	<title>{{#i18n}}actualites.title{{/i18n}}</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script src="{{#infra}}js/loader.js{{/infra}}" type="text/javascript" id="context"></script>
	<script src="/actualites/public/js/model.js" type="text/javascript"></script>
	<script src="/actualites/public/js/controller.js" type="text/javascript"></script>
	<script type="text/ng-actualites" id="empty"></script>
</head>
<body ng-controller="ActualitesController">
<portal>
	<h1 translate content="actualites.title"></h1>
	<p>Les actualites de l'ent-core.</p>

	<div class="row">
		<!-- Thread Navigation -->
		<nav class="vertical cell three">
		    <ul>
			  <li ng-repeat="thread in threads.all">
			    <a ng-class="{selected: thread === currentThread}" ng-click="selectThread(thread)">
			    	<i role="close" ng-click="thread.remove()" ng-if="thread === currentThread"></i>[[thread.title]]
			    </a>
			  </li>
			</ul>
		</nav>

		<div class="cell eight">

			<!-- Thread actions -->
			<div class="row height-one">
				<div class="absolute">
					<button ng-click="createThread()">Nouveau fil d'actualites</button>
					<button ng-click="createInfo()" ng-if="hasCurrentThread()">Nouvelle actualite</button>
					<behaviour name="edit" resource="currentThread" class="cell">
						<button ng-click="template.open('edition', 'thread-edit-form')">Editer le fil d'actualites</button>
					</behaviour>
					<button ng-click="display.showPanel = true" ng-if="hasCurrentThread()">Partager le fil</button>
				</div>
			</div>

			<!-- Thread edition -->
			<div ng-include="template.containers.edition">
			</div>

			<!-- Infos -->
			<div class="row">
				<article ng-repeat="info in currentThread.infos.all">

					<!-- Info display -->
					<div ng-if="(! hasCurrentInfo()) || (info !== currentInfo)">
						<div class="row">
							<h2>[[info.title]]</h2>
							<i class="right-magnet" role="close" ng-click="removeInfo(info)"></i>
						</div>

						<div class="row">
							<span ng-if="info.hasPublicationDate === true">Date de publication: [[info.publicationDate]]</span>
							<span ng-if="info.hasExpirationDate === true">Date d'expiration': [[info.expirationDate]]</span>
						</div>

						<div class="row" bind-html="info.content">
						</div>

						<div class="row">
							<behaviour name="edit" resource="currentThread">
								<button ng-click="editInfo(info)">Editer</button>
							</behaviour>
							<button workflow="actualites.publish">Publier</button>
						</div>
					</div>

					<!-- Info edition -->
					<div ng-if="info === currentInfo" ng-include="template.containers.editinfo">
					</div>

				</article>
			</div>
		</div>
	</div>

</portal>

<!-- Lightbox : Thread share -->
<div ng-if="hasCurrentThread()">
	<behaviour name="share" resource="currentThread">
		<lightbox show="display.showPanel" on-close="display.showPanel = false">
			<share-panel resources="currentThread">
			</share-panel>
		</lightbox>
	</behaviour>
</div>

</body>
</html>